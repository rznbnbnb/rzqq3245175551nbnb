local player = game:GetService("Players").LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

-- 白名单系统
local whitelistUrl = "https://gist.githubusercontent.com/rznbnbnb/2da5151919e4c03961b2e92e79f0c698/raw/e69073736470614382e0fd41e5f085db0df73d88/baimindan.json" -- 替换为您的白名单URL
local whitelistedPlayers = {}

-- 尝试获取白名单
local function FetchWhitelist()
    local success, result = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(whitelistUrl))
    end)
    
    if success then
        whitelistedPlayers = result
        return true
    else
        return false
    end
end

-- 显示屏幕中央消息
local function ShowCenterMessage(text, duration)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WhitelistMessage"
    screenGui.Parent = game.CoreGui
    screenGui.ResetOnSpawn = false
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0, 400, 0, 100)
    textLabel.Position = UDim2.new(0.5, -200, 0.5, -50)
    textLabel.AnchorPoint = Vector2.new(0.5, 0.5)
    textLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.BackgroundTransparency = 0.5
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextSize = 24
    textLabel.Text = text
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = screenGui
    
    -- 淡入效果
    textLabel.BackgroundTransparency = 1
    textLabel.TextTransparency = 1
    
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(textLabel, tweenInfo, {
        BackgroundTransparency = 0.5,
        TextTransparency = 0
    })
    tween:Play()
    
    -- 等待指定时间后淡出并销毁
    task.wait(duration)
    
    local tweenOut = TweenService:Create(textLabel, tweenInfo, {
        BackgroundTransparency = 1,
        TextTransparency = 1
    })
    tweenOut:Play()
    
    tweenOut.Completed:Connect(function()
        screenGui:Destroy()
    end)
end

-- 白名单检查
local function CheckWhitelist()
    local fetched = FetchWhitelist()
    
    if not fetched then
        player:Kick("白名单获取失败，请重试或联系管理员")
        return false
    end
    
    local userId = player.UserId
    
    for _, whitelistedId in ipairs(whitelistedPlayers) do
        if whitelistedId == userId then
            ShowCenterMessage("你已经通过白名单检测", 1)
            task.wait(1)
            return true
        end
    end
    
    player:Kick("请去找脚本作者添加白名单")
    return false
end

-- 如果不在白名单中，脚本将不会继续执行
if not CheckWhitelist() then
    return
end

-- 以下是您原有的脚本内容
local character = player.Character or player.CharacterAdded:Wait()
local HumanoidRootPart = character:WaitForChild("HumanoidRootPart")
HumanoidRootPart.CFrame = CFrame.new(677.13,62.14,202.05)
local humanoid = character:WaitForChild("Humanoid")
local scriptStartTime = os.time()
local forbiddenZoneCenter = Vector3.new(352.884155, 13.0287256, -1353.05396)
local forbiddenRadius = 80
local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?limit=100"))
local currentJobId = game.JobId
local availableServers = {}

for _, server in ipairs(servers.data) do
    if server.id ~= currentJobId and server.playing < server.maxPlayers then
        table.insert(availableServers, server.id)
    end
end

local targetItems = {
    "Money Printer",
    "Blue Candy Cane",
    "Bunny Balloon",
    "Ghost Balloon",
    "Clover Balloon",
    "Bat Balloon",
    "Gold Clover Balloon",
    "Golden Rose",
    "Black Rose",
    "Heart Balloon",
    "Diamond Ring",
    "Diamond",
    "Void Gem",
    "Dark Matter Gem",
    "Rollie",
    "NextBot Grenade",
      "Nuclear Missile Launcher",
       "Suitcase Nuke",
        "Helicopter",
         "Trident",
          "Golden Cup",
          "One Dollar Ballon"
            
}

local function ShowNotification(text)
    game.StarterGui:SetCore(
        "SendNotification",
        {
            Title = "rz自动收集物品",
            Text = text,
            Duration = 5
        }
    )
end

local function checkTimeout()
    return (os.time() - scriptStartTime) >= 120
end

local function TPServer()
    if #availableServers > 0 then
        TeleportService:TeleportToPlaceInstance(game.PlaceId, availableServers[math.random(1, #availableServers)])
    else
        ShowNotification("服务器解析失败")
    end
end

local function AutoPickItem()
    ShowNotification("寻找")

    while task.wait(0.1) do
        if checkTimeout() then
            TPServer()
            return false
        end

        local foundItem = false
        for _, itemFolder in pairs(game:GetService("Workspace").Game.Entities.ItemPickup:GetChildren()) do
            for _, item in pairs(itemFolder:GetChildren()) do
                if item:IsA("MeshPart") or item:IsA("Part") then
                    local itemPos = item.Position
                    local distance = (itemPos - forbiddenZoneCenter).Magnitude
        
                    if distance > forbiddenRadius then
                        for _, child in pairs(item:GetChildren()) do
                            if child:IsA("ProximityPrompt") then
                                for _, targetName in pairs(targetItems) do
                                    if child.ObjectText == targetName then
                                        foundItem = true
                                        child.RequiresLineOfSight = false
                                        child.HoldDuration = 0
                                        humanoid:Move(Vector3.new(1, 0, 0))
                                        HumanoidRootPart.CFrame = item.CFrame * CFrame.new(0, 2, 0)
                                        fireproximityprompt(child)
                                        
                                        local startTime = tick()
                                        local timeout = 5
                                        local connection
                                        connection = game:GetService("RunService").Heartbeat:Connect(function()
                                            if not item or not item.Parent then
                                                connection:Disconnect()
                                                return
                                            end
                                            
                                            if tick() - startTime >= timeout then
                                                item:Destroy()
                                                connection:Disconnect()
                                            end
                                        end)
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end

        if not foundItem then
            ShowNotification("没有物品可以捡")
            return true
        end
    end
end

local function AutoFarmBank()
    ShowNotification("找到了银行正在为您打开")

    local BankDoor = workspace.BankRobbery.VaultDoor
    local BankCashs = workspace.BankRobbery.BankCash

    while task.wait(0.1) do
        if checkTimeout() then
            TPServer()
            return
        end

        if BankDoor.Door.Attachment.ProximityPrompt.Enabled == true and BankCashs.Cash:FindFirstChild("Bundle") then
            HumanoidRootPart.CFrame = CFrame.new(1078.08093, 6.24685, -343.95758)
            BankDoor.Door.Attachment.ProximityPrompt.HoldDuration = 0
            fireproximityprompt(BankDoor.Door.Attachment.ProximityPrompt)
            task.wait(0.5)
        elseif not BankDoor.Door.Attachment.ProximityPrompt.Enabled and BankCashs.Cash:FindFirstChild("Bundle") then
            local targetPos = BankCashs.Cash:FindFirstChild("Bundle"):GetPivot().Position
            local basePosition = Vector3.new(targetPos.X, targetPos.Y - 5, targetPos.Z)
            local lookVector = (targetPos - basePosition).Unit
            HumanoidRootPart.CFrame = CFrame.new(basePosition, basePosition + lookVector)
            BankCashs.Main.Attachment.ProximityPrompt.RequiresLineOfSight = false
            BankCashs.Main.Attachment.ProximityPrompt.HoldDuration = 0
            fireproximityprompt(BankCashs.Main.Attachment.ProximityPrompt)
            task.wait(0.01)
        else
            ShowNotification("即将换服")
            task.wait(0.01)
            TPServer()
            return
        end
    end
end

ShowNotification("试图捡起他们")

local itemsFinished = AutoPickItem()

if itemsFinished then
    AutoFarmBank()
end